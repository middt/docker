#
# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

apisix:
#  extra_lua_path: "/opt/?.lua"
  node_listen: 9080              # APISIX listening port
  enable_ipv6: false
  config_center: yaml               #1

plugins:
  - error-log-logger
  - opentelemetry                  #2
  - proxy-rewrite
  - openid-connect
  - serverless-pre-function

plugin_attr:
  opentelemetry:
    # trace_id_source: x-instance-id - Source of the trace ID. Valid values are random or x-request-id. When set to x-request-id, the value of the x-request-id header will be used as trace ID. Make sure that it matches the regex pattern [0-9a-f]{32}.
    resource:
      service.name: APISIX-INTERNAL         #3
    collector:
      #4  address: jaeger:4318         #4
      address: http://host.docker.internal:5080/api/default
      request_headers:              # Set the headers to include in requests to the OpenTelemetry collector.
        Authorization: Basic cm9vdEByb290LmNvbTpqd1IwaFo3ZFhWWUVMdG5l

global_rules:
  - id: 1
    plugins:
      opentelemetry:
        sampler:
          name: always_on          #1
    
deployment:
  admin:
    allow_admin:               # https://nginx.org/en/docs/http/ngx_http_access_module.html#allow
      - 0.0.0.0/0              # We need to restrict ip access rules for security. 0.0.0.0/0 is for test.

    admin_key:
      - name: "admin"
        key: edd1c9f034335f136f87ad84b625c8f1
        role: admin                 # admin: manage all configuration data

  etcd:
    host:                           # it's possible to define multiple etcd hosts addresses of the same etcd cluster.
      - "http://etcd:2379"          # multiple etcd address
    prefix: "/apisix-internal"               # apisix configurations prefix
    timeout: 30                     # 30 seconds

nginx_config:
  error_log_level: warn